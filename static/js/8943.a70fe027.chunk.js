"use strict";(self.webpackChunkfuse_react_app=self.webpackChunkfuse_react_app||[]).push([[8943],{48103:function(t,r,e){e.d(r,{D:function(){return A},F:function(){return l},I:function(){return f},a:function(){return d},b:function(){return x},c:function(){return g},f:function(){return h},g:function(){return b},u:function(){return w}});var n=e(29439),a=e(74165),s=e(1413),c=e(15861),i=e(56571),o=e(52009),u=e(19560),p=e(39707),f=function(){return o.arrayify("0x80ac58cd")}(),d=function(){return o.arrayify("0xd9b67a26")}(),l={name:"Failed to load NFT metadata"};function h(t,r,e){return v.apply(this,arguments)}function v(){return(v=(0,c.Z)((0,a.Z)().mark((function t(r,e,n){var c,p,f,d,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.startsWith("data:application/json;base64")||"undefined"===typeof Buffer){t.next=4;break}return c=e.split(",")[1],p=JSON.parse(Buffer.from(c,"base64").toString("utf-8")),t.abrupt("return",i.C.parse((0,s.Z)((0,s.Z)({},p),{},{id:u.O$.from(r).toString(),uri:e})));case 4:return f=e.replace("{id}",o.hexZeroPad(u.O$.from(r).toHexString(),32).slice(2)),t.prev=5,t.next=8,n.downloadJSON(f);case 8:d=t.sent,t.next=24;break;case 11:return t.prev=11,t.t0=t.catch(5),h=e.replace("{id}",u.O$.from(r).toString()),t.prev=14,t.next=17,n.downloadJSON(h);case 17:d=t.sent,t.next=24;break;case 20:t.prev=20,t.t1=t.catch(14),console.warn("failed to get token metadata: ".concat(JSON.stringify({tokenId:r.toString(),tokenUri:e})," -- falling back to default metadata")),d=l;case 24:return t.abrupt("return",i.C.parse((0,s.Z)((0,s.Z)({},d),{},{id:u.O$.from(r).toString(),uri:e})));case 25:case"end":return t.stop()}}),t,null,[[5,11],[14,20]])})))).apply(this,arguments)}function g(t,r,e,n){return m.apply(this,arguments)}function m(){return(m=(0,c.Z)((0,a.Z)().mark((function t(r,c,o,v){var g,m,x,k,w,y,b,Z,W,A,C;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(5025).then(e.t.bind(e,25025,19));case 2:return m=t.sent.default,x=new p.CH(r,m,c),t.next=6,Promise.all([x.supportsInterface(f),x.supportsInterface(d)]);case 6:if(k=t.sent,w=(0,n.Z)(k,2),y=w[0],b=w[1],!y){t.next=20;break}return t.next=13,Promise.resolve().then(e.t.bind(e,34161,19));case 13:return Z=t.sent.default,W=new p.CH(r,Z,c),t.next=17,W.tokenURI(o);case 17:case 27:g=t.sent,t.next=31;break;case 20:if(!b){t.next=30;break}return t.next=23,Promise.resolve().then(e.t.bind(e,50266,19));case 23:return A=t.sent.default,C=new p.CH(r,A,c),t.next=27,C.uri(o);case 30:throw Error("Contract must implement ERC 1155 or ERC 721.");case 31:if(g){t.next=33;break}return t.abrupt("return",i.C.parse((0,s.Z)((0,s.Z)({},l),{},{id:u.O$.from(o).toString(),uri:""})));case 33:return t.abrupt("return",h(o,g,v));case 34:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t,r){return k.apply(this,arguments)}function k(){return(k=(0,c.Z)((0,a.Z)().mark((function t(r,e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof r){t.next=4;break}return t.abrupt("return",r);case 4:return t.next=6,e.upload(i.a.parse(r));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t,r,e,n){return y.apply(this,arguments)}function y(){return(y=(0,c.Z)((0,a.Z)().mark((function t(r,e,n,s){var c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Z(r)){t.next=4;break}return t.abrupt("return",r);case 4:if(!W(r)){t.next=11;break}return t.next=7,e.uploadBatch(r.map((function(t){return i.a.parse(t)})),{rewriteFileNames:{fileStartNumber:n||0},onProgress:null===s||void 0===s?void 0:s.onProgress});case 7:return c=t.sent,t.abrupt("return",c);case 11:throw new Error("NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)");case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t){for(var r=t[0].substring(0,t[0].lastIndexOf("/")),e=0;e<t.length;e++){var n=t[e].substring(0,t[e].lastIndexOf("/"));if(r!==n)throw new Error("Can only create batches with the same base URI for every entry in the batch. Expected '".concat(r,"' but got '").concat(n,"'"))}return r.replace(/\/$/,"")+"/"}function Z(t){return void 0===t.find((function(t){return"string"!==typeof t}))}function W(t){return void 0===t.find((function(t){return"object"!==typeof t}))}var A=100},68573:function(t,r,e){e.d(r,{c:function(){return s}});var n=e(43414),a=e(84546);function s(t){return(0,a.i)(t)?n.aV:t}},91612:function(t,r,e){e.d(r,{C:function(){return s}});var n=e(15671),a=e(43144),s=function(){function t(r){(0,n.Z)(this,t),this.contractWrapper=r}return(0,a.Z)(t,[{key:"overrideNextTransaction",value:function(t){this.contractWrapper.withTransactionOverride(t)}}]),t}()},69981:function(t,r,e){e.d(r,{C:function(){return f}});var n=e(29439),a=e(74165),s=e(15861),c=e(15671),i=e(43144),o=e(4942),u=e(35867),p=e(43414),f=function(){function t(r){var e=this;(0,c.Z)(this,t),(0,o.Z)(this,"featureName",p.dk.name),(0,o.Z)(this,"set",(0,u.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.bF.parseAsync(r);case 2:return n=t.sent,t.abrupt("return",u.T.fromContractWrapper({contractWrapper:e.contractWrapper,method:"setPlatformFeeInfo",args:[n.platform_fee_recipient,n.platform_fee_basis_points]}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r}return(0,i.Z)(t,[{key:"get",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var r,e,s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("getPlatformFeeInfo",[]);case 2:return r=t.sent,e=(0,n.Z)(r,2),s=e[0],c=e[1],t.abrupt("return",p.bF.parseAsync({platform_fee_recipient:s,platform_fee_basis_points:c}));case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()},35770:function(t,r,e){e.d(r,{a:function(){return k},g:function(){return w},h:function(){return h},i:function(){return d},m:function(){return m},v:function(){return g}});var n=e(74165),a=e(29439),s=e(15861),c=e(39707),i=e(19560),o=e(17389),u=e(48103),p=e(43414),f=e(84546);function d(t,r,e,n,a){return l.apply(this,arguments)}function l(){return(l=(0,s.Z)((0,n.Z)().mark((function t(r,s,i,o,p){var f,d,l,h,v,g,m,x,k,w,y,b;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.e(5025).then(e.t.bind(e,25025,19));case 3:return f=t.sent.default,d=new c.CH(i,f,r),t.next=7,Promise.all([d.supportsInterface(u.I),d.supportsInterface(u.a)]);case 7:if(l=t.sent,h=(0,a.Z)(l,2),v=h[0],g=h[1],!v){t.next=32;break}return t.next=14,Promise.resolve().then(e.t.bind(e,70332,19));case 14:return x=t.sent.default,k=new c.CH(i,x,r),t.next=18,k.isApprovedForAll(p,s);case 18:if(!t.sent){t.next=21;break}return t.abrupt("return",!0);case 21:return t.prev=21,t.next=24,k.getApproved(o);case 24:w=t.sent,t.next=29;break;case 27:t.prev=27,t.t0=t.catch(21);case 29:return t.abrupt("return",(null===(m=w)||void 0===m?void 0:m.toLowerCase())===s.toLowerCase());case 32:if(!g){t.next=42;break}return t.next=35,Promise.resolve().then(e.t.bind(e,8455,19));case 35:return y=t.sent.default,b=new c.CH(i,y,r),t.next=39,b.isApprovedForAll(p,s);case 39:return t.abrupt("return",t.sent);case 42:return console.error("Contract does not implement ERC 1155 or ERC 721."),t.abrupt("return",!1);case 44:t.next=50;break;case 46:return t.prev=46,t.t1=t.catch(0),console.error("Failed to check if token is approved",t.t1),t.abrupt("return",!1);case 50:case"end":return t.stop()}}),t,null,[[0,46],[21,27]])})))).apply(this,arguments)}function h(t,r,e,n,a){return v.apply(this,arguments)}function v(){return(v=(0,s.Z)((0,n.Z)().mark((function t(r,s,c,i,o){var f,d,l,h,v,g,m,x,k,w;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(5025).then(e.t.bind(e,25025,19));case 2:return f=t.sent.default,d=new p.cr(r.getSignerOrProvider(),c,f,r.options,r.storage),t.next=6,Promise.all([d.read("supportsInterface",[u.I]),d.read("supportsInterface",[u.a])]);case 6:if(l=t.sent,h=(0,a.Z)(l,2),v=h[0],g=h[1],!v){t.next=29;break}return t.next=13,Promise.resolve().then(e.t.bind(e,70332,19));case 13:return m=t.sent.default,x=new p.cr(r.getSignerOrProvider(),c,m,r.options,r.storage),t.next=17,x.read("isApprovedForAll",[o,s]);case 17:if(t.sent){t.next=27;break}return t.next=21,x.read("getApproved",[i]);case 21:if(t.t0=t.sent.toLowerCase(),t.t1=s.toLowerCase(),t.t0===t.t1){t.next=27;break}return t.next=27,x.sendTransaction("setApprovalForAll",[s,!0]);case 27:case 40:t.next=43;break;case 29:if(!g){t.next=42;break}return t.next=32,Promise.resolve().then(e.t.bind(e,8455,19));case 32:return k=t.sent.default,w=new p.cr(r.getSignerOrProvider(),c,k,r.options,r.storage),t.next=36,w.read("isApprovedForAll",[o,s]);case 36:if(t.sent){t.next=40;break}return t.next=40,w.sendTransaction("setApprovalForAll",[s,!0]);case 42:throw Error("Contract must implement ERC 1155 or ERC 721.");case 43:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){if((0,o.Z)(void 0!==t.assetContractAddress&&null!==t.assetContractAddress,"Asset contract address is required"),(0,o.Z)(void 0!==t.buyoutPricePerToken&&null!==t.buyoutPricePerToken,"Buyout price is required"),(0,o.Z)(void 0!==t.listingDurationInSeconds&&null!==t.listingDurationInSeconds,"Listing duration is required"),(0,o.Z)(void 0!==t.startTimestamp&&null!==t.startTimestamp,"Start time is required"),(0,o.Z)(void 0!==t.tokenId&&null!==t.tokenId,"Token ID is required"),(0,o.Z)(void 0!==t.quantity&&null!==t.quantity,"Quantity is required"),"NewAuctionListing"===t.type)(0,o.Z)(void 0!==t.reservePricePerToken&&null!==t.reservePricePerToken,"Reserve price is required")}function m(t,r,e){return x.apply(this,arguments)}function x(){return(x=(0,s.Z)((0,n.Z)().mark((function t(r,e,a){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a.quantityDesired,t.t1=a.pricePerToken,t.t2=a.currency,t.t3=a.offeror,t.t4=a.quantityWanted,t.next=7,(0,f.a)(r,a.currency,a.quantityWanted.mul(a.pricePerToken));case 7:return t.t5=t.sent,t.t6=e,t.abrupt("return",{quantity:t.t0,pricePerToken:t.t1,currencyContractAddress:t.t2,buyerAddress:t.t3,quantityDesired:t.t4,currencyValue:t.t5,listingId:t.t6});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t,r,e){return e=i.O$.from(e),t=i.O$.from(t),r=i.O$.from(r),!t.eq(i.O$.from(0))&&r.sub(t).mul(p.dv).div(t).gte(e)}function w(t,r,e){return y.apply(this,arguments)}function y(){return(y=(0,s.Z)((0,n.Z)().mark((function t(r,e,a){var s;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(s=[];e-r>u.D;)s.push(a(r,r+u.D-1)),r+=u.D;return s.push(a(r,e-1)),t.next=5,Promise.all(s);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},48943:function(t,r,e){e.r(r),e.d(r,{Marketplace:function(){return S}});var n=e(93433),a=e(74165),s=e(15861),c=e(15671),i=e(43144),o=e(4942),u=e(19560),p=e(81895),f=e(17389),d=e(48103),l=e(84546),h=e(43414),v=e(35770),g=e(35867),m=e(53792),x=e(91612),k=e(69981),w=e(70304),y=e(29439),b=e(6321),Z=e(28552),W=e(39707),A=e(18383),C=e(68573),T=e(88034),P=e(56571),L=function(t){return t[t.Direct=0]="Direct",t[t.Auction=1]="Auction",t}({}),I=function(){function t(r,e){var n=this;(0,c.Z)(this,t),(0,o.Z)(this,"createListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,s,c,i,o,p;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,v.v)(r),t.next=3,(0,h.aM)(r.assetContractAddress);case 3:return e=t.sent,t.next=6,(0,h.aM)(r.currencyContractAddress);case 6:return s=t.sent,t.t0=v.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=e,t.t4=r.tokenId,t.next=14,n.contractWrapper.getSignerAddress();case 14:return t.t5=t.sent,t.next=17,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 17:return t.next=19,(0,T.n)(n.contractWrapper.getProvider(),r.buyoutPricePerToken,s);case 19:return c=t.sent,i=Math.floor(r.startTimestamp.getTime()/1e3),t.next=23,n.contractWrapper.getProvider().getBlock("latest");case 23:return o=t.sent,p=o.timestamp,i<p&&(i=p),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"createListing",args:[{assetContract:e,tokenId:r.tokenId,buyoutPricePerToken:c,currencyToAccept:(0,C.c)(s),listingType:L.Direct,quantityToList:r.quantity,reservePricePerToken:c,secondsUntilEndTime:r.listingDurationInSeconds,startTime:u.O$.from(i)}],parse:function(t){return{id:n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs)[0].args.listingId,receipt:t}}}));case 27:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"createListingsBatch",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return n.createListing.prepare(t)})));case 2:return e=t.sent.map((function(t){return t.encode()})),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[e],parse:function(t){return n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs).map((function(r){return{id:r.args.listingId,receipt:t}}))}}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"makeOffer",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e,s,c,i){var o,p,f,d,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,l.i)(s)){t.next=2;break}throw new Error("You must use the wrapped native token address when making an offer with a native token");case 2:return t.next=4,(0,T.n)(n.contractWrapper.getProvider(),c,s);case 4:return o=t.sent,t.prev=5,t.next=8,n.getListing(r);case 8:t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(5),console.error("Failed to get listing, err =",t.t0),new Error("Error getting the listing with id ".concat(r));case 14:return p=u.O$.from(e),f=u.O$.from(o).mul(p),t.next=18,n.contractWrapper.getCallOverrides();case 18:if(t.t1=t.sent,t.t1){t.next=21;break}t.t1={};case 21:return d=t.t1,t.next=24,(0,P.s)(n.contractWrapper,f,s,d);case 24:return h=b.Bz,i&&(h=u.O$.from(Math.floor(i.getTime()/1e3))),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"offer",args:[r,e,s,o,h],overrides:d}));case 27:case"end":return t.stop()}}),t,null,[[5,10]])})));return function(r,e,n,a,s){return t.apply(this,arguments)}}())),(0,o.Z)(this,"acceptOffer",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e){var s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(u.O$.from(r));case 2:return t.next=4,(0,h.aM)(e);case 4:return s=t.sent,t.next=7,n.contractWrapper.read("offers",[r,s]);case 7:return c=t.sent,t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"acceptOffer",args:[r,s,c.currency,c.pricePerToken]}));case 9:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,o.Z)(this,"buyoutListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e,s){var c,i,o,p,f,d,l,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(u.O$.from(r));case 2:return c=t.sent,t.next=5,n.isStillValidListing(c,e);case 5:if(i=t.sent,o=i.valid,p=i.error,o){t.next=10;break}throw new Error("Listing ".concat(r," is no longer valid. ").concat(p));case 10:if(!s){t.next=14;break}t.t0=s,t.next=17;break;case 14:return t.next=16,n.contractWrapper.getSignerAddress();case 16:t.t0=t.sent;case 17:return f=t.t0,d=u.O$.from(e),l=u.O$.from(c.buyoutPrice).mul(d),t.next=22,n.contractWrapper.getCallOverrides();case 22:if(t.t1=t.sent,t.t1){t.next=25;break}t.t1={};case 25:return h=t.t1,t.next=28,(0,P.s)(n.contractWrapper,l,c.currencyContractAddress,h);case 28:return t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"buy",args:[r,f,d,c.currencyContractAddress,l],overrides:h}));case 29:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,o.Z)(this,"updateListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=g.T,t.t1=n.contractWrapper,t.t2=r.id,t.t3=r.quantity,t.t4=r.buyoutPrice,t.t5=r.buyoutPrice,t.next=8,(0,h.aM)(r.currencyContractAddress);case 8:return t.t6=t.sent,t.t7=r.startTimeInSeconds,t.t8=r.secondsUntilEnd,t.t9=[t.t2,t.t3,t.t4,t.t5,t.t6,t.t7,t.t8],t.t10={contractWrapper:t.t1,method:"updateListing",args:t.t9},t.abrupt("return",t.t0.fromContractWrapper.call(t.t0,t.t10));case 14:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"cancelListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"cancelDirectListing",args:[r]}));case 1:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e}return(0,i.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("listings",[r]);case 2:if((e=t.sent).assetContract!==p.d){t.next=5;break}throw new h.L(this.getAddress(),r.toString());case 5:if(e.listingType===L.Direct){t.next=7;break}throw new h.W(this.getAddress(),r.toString(),"Auction","Direct");case 7:return t.next=9,this.mapListing(e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getActiveOffer",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(u.O$.from(r));case 2:return(0,f.Z)(Z.isAddress(e),"Address must be a valid address"),t.t0=this.contractWrapper,t.t1=r,t.next=7,(0,h.aM)(e);case 7:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=11,t.t0.read.call(t.t0,"offers",t.t3);case 11:if((n=t.sent).offeror!==p.d){t.next=14;break}return t.abrupt("return",void 0);case 14:return t.next=16,(0,v.m)(this.contractWrapper.getProvider(),u.O$.from(r),n);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"validateListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getListing(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the listing with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.assetContract,t.t1=u.O$.from(r.buyoutPricePerToken),t.t2=r.currency,t.next=5,(0,l.a)(this.contractWrapper.getProvider(),r.currency,r.buyoutPricePerToken);case 5:return t.t3=t.sent,t.t4=r.listingId.toString(),t.t5=r.tokenId,t.t6=r.quantity,t.t7=r.startTime,t.next=12,(0,d.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 12:return t.t8=t.sent,t.t9=r.endTime,t.t10=r.tokenOwner,t.t11=L.Direct,t.abrupt("return",{assetContractAddress:t.t0,buyoutPrice:t.t1,currencyContractAddress:t.t2,buyoutCurrencyValuePerToken:t.t3,id:t.t4,tokenId:t.t5,quantity:t.t6,startTimeInSeconds:t.t7,asset:t.t8,secondsUntilEnd:t.t9,sellerAddress:t.t10,type:t.t11});case 17:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isStillValidListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,n){var s,c,i,o,u,p,f,l,h,g,m,x,k,w;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,v.i)(this.contractWrapper.getProvider(),this.getAddress(),r.assetContractAddress,r.tokenId,r.sellerAddress);case 2:if(t.sent){t.next=5;break}return t.abrupt("return",{valid:!1,error:"Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress,"' is not approved for transfer")});case 5:return s=this.contractWrapper.getProvider(),t.next=8,e.e(5025).then(e.t.bind(e,25025,19));case 8:return c=t.sent.default,i=new W.CH(r.assetContractAddress,c,s),t.next=12,i.supportsInterface(d.I);case 12:return o=t.sent,t.next=15,i.supportsInterface(d.a);case 15:if(u=t.sent,!o){t.next=33;break}return t.next=19,Promise.resolve().then(e.t.bind(e,70332,19));case 19:return f=t.sent.default,l=new W.CH(r.assetContractAddress,f,s),t.prev=21,t.next=24,l.ownerOf(r.tokenId);case 24:h=t.sent,t.next=29;break;case 27:t.prev=27,t.t0=t.catch(21);case 29:return g=(null===(p=h)||void 0===p?void 0:p.toLowerCase())===r.sellerAddress.toLowerCase(),t.abrupt("return",{valid:g,error:g?void 0:"Seller is not the owner of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," anymore'")});case 33:if(!u){t.next=45;break}return t.next=36,Promise.resolve().then(e.t.bind(e,8455,19));case 36:return m=t.sent.default,x=new W.CH(r.assetContractAddress,m,s),t.next=40,x.balanceOf(r.sellerAddress,r.tokenId);case 40:return k=t.sent,w=k.gte(n||r.quantity),t.abrupt("return",{valid:w,error:w?void 0:"Seller does not have enough balance of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," to fulfill the listing")});case 45:return t.abrupt("return",{valid:!1,error:"Contract does not implement ERC 1155 or ERC 721."});case 46:case"end":return t.stop()}}),t,this,[[21,27]])})));return function(r,e){return t.apply(this,arguments)}}()}]),t}(),O=function(){function t(r,e){var n=this;(0,c.Z)(this,t),(0,o.Z)(this,"createListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,s,c,i,o,p,f;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,v.v)(r),t.next=3,(0,h.aM)(r.assetContractAddress);case 3:return e=t.sent,t.next=6,(0,h.aM)(r.currencyContractAddress);case 6:return s=t.sent,t.t0=v.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=e,t.t4=r.tokenId,t.next=14,n.contractWrapper.getSignerAddress();case 14:return t.t5=t.sent,t.next=17,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 17:return t.next=19,(0,T.n)(n.contractWrapper.getProvider(),r.buyoutPricePerToken,s);case 19:return c=t.sent,t.next=22,(0,T.n)(n.contractWrapper.getProvider(),r.reservePricePerToken,s);case 22:return i=t.sent,o=Math.floor(r.startTimestamp.getTime()/1e3),t.next=26,n.contractWrapper.getProvider().getBlock("latest");case 26:return p=t.sent,f=p.timestamp,o<f&&(o=f),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"createListing",args:[{assetContract:e,tokenId:r.tokenId,buyoutPricePerToken:c,currencyToAccept:(0,C.c)(s),listingType:L.Auction,quantityToList:r.quantity,reservePricePerToken:i,secondsUntilEndTime:r.listingDurationInSeconds,startTime:u.O$.from(o)}],parse:function(t){return{id:n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs)[0].args.listingId,receipt:t}}}));case 30:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"createListingsBatch",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return n.createListing.prepare(t)})));case 2:return e=t.sent.map((function(t){return t.encode()})),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[e],parse:function(t){return n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs).map((function(r){return{id:r.args.listingId,receipt:t}}))}}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"buyoutListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(u.O$.from(r));case 2:return e=t.sent,t.next=5,(0,l.f)(n.contractWrapper.getProvider(),e.currencyContractAddress);case 5:return s=t.sent,t.abrupt("return",n.makeBid.prepare(r,A.formatUnits(e.buyoutPrice,s.decimals)));case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"makeBid",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e){var s,c,i,o,p,d,l,h,m,x;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(u.O$.from(r));case 2:return s=t.sent,t.next=5,(0,T.n)(n.contractWrapper.getProvider(),e,s.currencyContractAddress);case 5:if(!(c=t.sent).eq(u.O$.from(0))){t.next=8;break}throw new Error("Cannot make a bid with 0 value");case 8:return t.next=10,n.contractWrapper.read("bidBufferBps",[]);case 10:return i=t.sent,t.next=13,n.getWinningBid(r);case 13:return(o=t.sent)?(p=(0,v.a)(o.pricePerToken,c,i),(0,f.Z)(p,"Bid price is too low based on the current winning bid and the bid buffer")):(d=c,l=u.O$.from(s.reservePrice),(0,f.Z)(d.gte(l),"Bid price is too low based on reserve price")),h=u.O$.from(s.quantity),m=c.mul(h),t.next=19,n.contractWrapper.getCallOverrides();case 19:if(t.t0=t.sent,t.t0){t.next=22;break}t.t0={};case 22:return x=t.t0,t.next=25,(0,P.s)(n.contractWrapper,m,s.currencyContractAddress,x);case 25:return t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"offer",args:[r,s.quantity,s.currencyContractAddress,c,b.Bz],overrides:x}));case 26:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,o.Z)(this,"cancelListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,s,c,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(u.O$.from(r));case 2:return e=t.sent,s=u.O$.from(Math.floor(Date.now()/1e3)),c=u.O$.from(e.startTimeInEpochSeconds),t.next=7,n.contractWrapper.read("winningBid",[r]);case 7:if(i=t.sent,!s.gt(c)||i.offeror===p.d){t.next=10;break}throw new h.t(r.toString());case 10:return t.t0=g.T,t.t1=n.contractWrapper,t.t2=u.O$.from(r),t.next=15,n.contractWrapper.getSignerAddress();case 15:return t.t3=t.sent,t.t4=[t.t2,t.t3],t.t5={contractWrapper:t.t1,method:"closeAuction",args:t.t4},t.abrupt("return",t.t0.fromContractWrapper.call(t.t0,t.t5));case 19:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"closeListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e){var s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=4;break}return t.next=3,n.contractWrapper.getSignerAddress();case 3:e=t.sent;case 4:return t.next=6,n.validateListing(u.O$.from(r));case 6:return s=t.sent,t.prev=7,t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"closeAuction",args:[u.O$.from(r),e]}));case 11:if(t.prev=11,t.t0=t.catch(7),!t.t0.message.includes("cannot close auction before it has ended")){t.next=17;break}throw new h.w(r.toString(),s.endTimeInEpochSeconds.toString());case 17:throw t.t0;case 18:case"end":return t.stop()}}),t,null,[[7,11]])})));return function(r,e){return t.apply(this,arguments)}}())),(0,o.Z)(this,"executeSale",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,s,c,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(u.O$.from(r));case 2:return e=t.sent,t.prev=3,t.next=6,n.getWinningBid(r);case 6:return s=t.sent,(0,f.Z)(s,"No winning bid found"),c=n.encoder.encode("closeAuction",[r,e.sellerAddress]),i=n.encoder.encode("closeAuction",[r,s.buyerAddress]),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[c,i]}));case 13:if(t.prev=13,t.t0=t.catch(3),!t.t0.message.includes("cannot close auction before it has ended")){t.next=19;break}throw new h.w(r.toString(),e.endTimeInEpochSeconds.toString());case 19:throw t.t0;case 20:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"updateListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",g.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"updateListing",args:[r.id,r.quantity,r.reservePrice,r.buyoutPrice,r.currencyContractAddress,r.startTimeInEpochSeconds,r.endTimeInEpochSeconds]}));case 1:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e,this.encoder=new l.C(r)}return(0,i.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("listings",[r]);case 2:if((e=t.sent).listingId.toString()===r.toString()){t.next=5;break}throw new h.L(this.getAddress(),r.toString());case 5:if(e.listingType===L.Auction){t.next=7;break}throw new h.W(this.getAddress(),r.toString(),"Direct","Auction");case 7:return t.next=9,this.mapListing(e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getWinningBid",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(u.O$.from(r));case 2:return t.next=4,this.contractWrapper.read("winningBid",[r]);case 4:if((e=t.sent).offeror!==p.d){t.next=7;break}return t.abrupt("return",void 0);case 7:return t.next=9,(0,v.m)(this.contractWrapper.getProvider(),u.O$.from(r),e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getWinner",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,n,s,c,i,o,f;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(u.O$.from(r));case 2:return e=t.sent,t.next=5,this.contractWrapper.read("winningBid",[r]);case 5:if(n=t.sent,s=u.O$.from(Math.floor(Date.now()/1e3)),c=u.O$.from(e.endTimeInEpochSeconds),!s.gt(c)||n.offeror===p.d){t.next=10;break}return t.abrupt("return",n.offeror);case 10:return i=new m.a(this.contractWrapper),t.next=13,i.getEvents("AuctionClosed");case 13:if(o=t.sent,f=o.find((function(t){return t.data.listingId.eq(u.O$.from(r))}))){t.next=17;break}throw new Error("Could not find auction with listingId ".concat(r," in closed auctions"));case 17:return t.abrupt("return",f.data.winningBidder);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getBidBufferBps",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.read("bidBufferBps",[]));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getMinimumNextBid",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,n,s,c,i,o,p;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this.getBidBufferBps(),this.getWinningBid(r),this.validateListing(u.O$.from(r))]);case 2:return e=t.sent,n=(0,y.Z)(e,3),s=n[0],c=n[1],i=n[2],o=c?c.currencyValue.value:i.reservePrice,p=o.add(o.mul(s).div(1e4)),t.abrupt("return",(0,l.a)(this.contractWrapper.getProvider(),i.currencyContractAddress,p));case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"validateListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getListing(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the listing with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.assetContract,t.t1=u.O$.from(r.buyoutPricePerToken),t.t2=r.currency,t.next=5,(0,l.a)(this.contractWrapper.getProvider(),r.currency,r.buyoutPricePerToken);case 5:return t.t3=t.sent,t.t4=r.listingId.toString(),t.t5=r.tokenId,t.t6=r.quantity,t.t7=r.startTime,t.next=12,(0,d.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 12:return t.t8=t.sent,t.next=15,(0,l.a)(this.contractWrapper.getProvider(),r.currency,r.reservePricePerToken);case 15:return t.t9=t.sent,t.t10=u.O$.from(r.reservePricePerToken),t.t11=r.endTime,t.t12=r.tokenOwner,t.t13=L.Auction,t.abrupt("return",{assetContractAddress:t.t0,buyoutPrice:t.t1,currencyContractAddress:t.t2,buyoutCurrencyValuePerToken:t.t3,id:t.t4,tokenId:t.t5,quantity:t.t6,startTimeInEpochSeconds:t.t7,asset:t.t8,reservePriceCurrencyValuePerToken:t.t9,reservePrice:t.t10,endTimeInEpochSeconds:t.t11,sellerAddress:t.t12,type:t.t13});case 21:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()}]),t}(),S=(e(64166),e(79955),e(87962),function(){function t(r,e,n){var i=this;(0,c.Z)(this,t),(0,o.Z)(this,"getAll",this.getAllListings),(0,o.Z)(this,"buyoutListing",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e,n){var s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.contractWrapper.read("listings",[r]);case 2:if((s=t.sent).listingId.toString()===r.toString()){t.next=5;break}throw new h.L(i.getAddress(),r.toString());case 5:t.t0=s.listingType,t.next=t.t0===L.Direct?8:t.t0===L.Auction?12:15;break;case 8:return(0,f.Z)(void 0!==e,"quantityDesired is required when buying out a direct listing"),t.next=11,i.direct.buyoutListing.prepare(r,e,n);case 11:case 14:return t.abrupt("return",t.sent);case 12:return t.next=14,i.auction.buyoutListing.prepare(r);case 15:throw Error("Unknown listing type: ".concat(s.listingType));case 16:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,o.Z)(this,"makeOffer",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e,n){var s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.contractWrapper.read("listings",[r]);case 2:if((s=t.sent).listingId.toString()===r.toString()){t.next=5;break}throw new h.L(i.getAddress(),r.toString());case 5:return t.next=7,i.contractWrapper.getChainID();case 7:c=t.sent,t.t0=s.listingType,t.next=t.t0===L.Direct?11:t.t0===L.Auction?15:18;break;case 11:return(0,f.Z)(n,"quantity is required when making an offer on a direct listing"),t.next=14,i.direct.makeOffer.prepare(r,n,(0,l.i)(s.currency)?h.aW[c].wrapped.address:s.currency,e);case 14:case 17:return t.abrupt("return",t.sent);case 15:return t.next=17,i.auction.makeBid.prepare(r,e);case 18:throw Error("Unknown listing type: ".concat(s.listingType));case 19:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,o.Z)(this,"setBidBufferBps",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=i.roles,t.t1=["admin"],t.next=4,i.contractWrapper.getSignerAddress();case 4:return t.t2=t.sent,t.next=7,t.t0.verify.call(t.t0,t.t1,t.t2);case 7:return t.next=9,i.getTimeBufferInSeconds();case 9:return e=t.sent,t.abrupt("return",g.T.fromContractWrapper({contractWrapper:i.contractWrapper,method:"setAuctionBuffers",args:[e,u.O$.from(r)]}));case 11:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"setTimeBufferInSeconds",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=i.roles,t.t1=["admin"],t.next=4,i.contractWrapper.getSignerAddress();case 4:return t.t2=t.sent,t.next=7,t.t0.verify.call(t.t0,t.t1,t.t2);case 7:return t.next=9,i.getBidBufferBps();case 9:return e=t.sent,t.abrupt("return",g.T.fromContractWrapper({contractWrapper:i.contractWrapper,method:"setAuctionBuffers",args:[u.O$.from(r),e]}));case 11:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"allowListingFromSpecificAssetOnly",(0,g.c)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[],t.next=3,i.roles.get("asset");case 3:return t.sent.includes(p.d)&&e.push(i.encoder.encode("revokeRole",[(0,h.H)("asset"),p.d])),e.push(i.encoder.encode("grantRole",[(0,h.H)("asset"),r])),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:i.contractWrapper,method:"multicall",args:[e]}));case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,o.Z)(this,"allowListingFromAnyAsset",(0,g.c)((0,s.Z)((0,a.Z)().mark((function t(){var r,e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],t.next=3,i.roles.get("asset");case 3:for(e in t.sent)r.push(i.encoder.encode("revokeRole",[(0,h.H)("asset"),e]));return r.push(i.encoder.encode("grantRole",[(0,h.H)("asset"),p.d])),t.abrupt("return",g.T.fromContractWrapper({contractWrapper:i.contractWrapper,method:"multicall",args:[r]}));case 7:case"end":return t.stop()}}),t)})))));var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},v=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new h.cr(r,e,v,d,n);this._chainId=y,this.abi=h.bj.parse(v||[]),this.contractWrapper=b,this.storage=n,this.metadata=new m.C(this.contractWrapper,h.bZ,this.storage),this.app=new m.b(this.contractWrapper,this.metadata,this.storage),this.roles=new w.C(this.contractWrapper,t.contractRoles),this.encoder=new l.C(this.contractWrapper),this.estimator=new m.G(this.contractWrapper),this.direct=new I(this.contractWrapper,this.storage),this.auction=new O(this.contractWrapper,this.storage),this.events=new m.a(this.contractWrapper),this.platformFees=new k.C(this.contractWrapper),this.interceptor=new x.C(this.contractWrapper)}return(0,i.Z)(t,[{key:"chainId",get:function(){return this._chainId}},{key:"onNetworkUpdated",value:function(t){this.contractWrapper.updateSignerOrProvider(t)}},{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getListing",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("listings",[r]);case 2:if((e=t.sent).assetContract!==p.d){t.next=5;break}throw new h.L(this.getAddress(),r.toString());case 5:t.t0=e.listingType,t.next=t.t0===L.Auction?8:t.t0===L.Direct?11:14;break;case 8:return t.next=10,this.auction.mapListing(e);case 10:case 13:return t.abrupt("return",t.sent);case 11:return t.next=13,this.direct.mapListing(e);case 14:throw new Error("Unknown listing type: ".concat(e.listingType));case 15:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getActiveListings",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,n,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllListingsNoFilter(!0);case 2:return e=t.sent,n=this.applyFilter(e,r),s=u.O$.from(Math.floor(Date.now()/1e3)),t.abrupt("return",n.filter((function(t){return t.type===L.Auction&&u.O$.from(t.endTimeInEpochSeconds).gt(s)&&u.O$.from(t.startTimeInEpochSeconds).lte(s)||t.type===L.Direct&&u.O$.from(t.quantity).gt(0)})));case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllListings",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllListingsNoFilter(!1);case 2:return e=t.sent,t.abrupt("return",this.applyFilter(e,r));case 4:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getTotalCount",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("totalListings",[]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isRestrictedToListerRoleOnly",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("hasRole",[(0,h.H)("lister"),p.d]);case 2:return r=t.sent,t.abrupt("return",!r);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getBidBufferBps",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.read("bidBufferBps",[]));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getTimeBufferInSeconds",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.read("timeBuffer",[]));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getOffers",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,n=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.events.getEvents("NewOffer",{order:"desc",filters:{listingId:r}});case 2:return e=t.sent,t.next=5,Promise.all(e.map((function(t){return(0,v.m)(n.contractWrapper.getProvider(),u.O$.from(r),{quantityWanted:t.data.quantityWanted,pricePerToken:t.data.quantityWanted.gt(0)?t.data.totalOfferAmount.div(t.data.quantityWanted):t.data.totalOfferAmount,currency:t.data.currency,offeror:t.data.offeror})})));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllListingsNoFilter",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var e,n=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Promise,t.t1=Array,t.t2=Array,t.next=5,this.contractWrapper.read("totalListings",[]);case 5:return t.t3=t.sent.toNumber(),t.t4=(0,t.t2)(t.t3).keys(),t.t5=t.t1.from.call(t.t1,t.t4).map(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.getListing(e);case 3:s=t.sent,t.next=14;break;case 6:if(t.prev=6,t.t0=t.catch(0),!(t.t0 instanceof h.L)){t.next=12;break}return t.abrupt("return",void 0);case 12:return console.warn("Failed to get listing ".concat(e,"' - skipping. Try 'marketplace.getListing(").concat(e,")' to get the underlying error.")),t.abrupt("return",void 0);case 14:if(s.type!==L.Auction){t.next=16;break}return t.abrupt("return",s);case 16:if(!r){t.next=23;break}return t.next=19,n.direct.isStillValidListing(s);case 19:if(c=t.sent,c.valid){t.next=23;break}return t.abrupt("return",void 0);case 23:return t.abrupt("return",s);case 24:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()),t.next=10,t.t0.all.call(t.t0,t.t5);case 10:return e=t.sent,t.abrupt("return",e.filter((function(t){return void 0!==t})));case 12:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(t,r){var e=(0,n.Z)(t),a=u.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),s=u.O$.from((null===r||void 0===r?void 0:r.count)||d.D).toNumber();return r&&(r.seller&&(e=e.filter((function(t){var e;return t.sellerAddress.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.seller)||void 0===e?void 0:e.toString().toLowerCase())}))),r.tokenContract&&(e=e.filter((function(t){var e;return t.assetContractAddress.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.tokenContract)||void 0===e?void 0:e.toString().toLowerCase())}))),void 0!==r.tokenId&&(e=e.filter((function(t){var e;return t.tokenId.toString()===(null===r||void 0===r||null===(e=r.tokenId)||void 0===e?void 0:e.toString())}))),e=(e=e.filter((function(t,r){return r>=a}))).slice(0,s)),e}},{key:"prepare",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",g.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:r,args:e,overrides:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(r,e,n){return t.apply(this,arguments)}}()},{key:"call",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r,e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.call(r,e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(r,e,n){return t.apply(this,arguments)}}()}]),t}());(0,o.Z)(S,"contractRoles",h.dx)},56571:function(t,r,e){e.d(r,{B:function(){return p},C:function(){return l},N:function(){return d},a:function(){return f},s:function(){return h}});var n=e(74165),a=e(15861),s=e(43414),c=e(99094),i=e(84546),o=function(){return c.z.object({}).catchall(c.z.union([s.cx,c.z.unknown()]))}(),u=function(){return c.z.union([c.z.array(o),o]).optional().nullable()}(),p=function(){return c.z.object({name:c.z.union([c.z.string(),c.z.number()]).optional().nullable(),description:c.z.string().nullable().optional().nullable(),image:s.cy.nullable().optional(),animation_url:s.cy.optional().nullable()})}(),f=function(){return p.extend({external_url:s.cy.nullable().optional(),background_color:s.cz.optional().nullable(),properties:u,attributes:u}).catchall(c.z.union([s.cx,c.z.unknown()]))}(),d=function(){return c.z.union([f,c.z.string()])}(),l=function(){return f.extend({id:c.z.string(),uri:c.z.string(),image:c.z.string().nullable().optional(),external_url:c.z.string().nullable().optional(),animation_url:c.z.string().nullable().optional()})}();function h(t,r,e,n){return v.apply(this,arguments)}function v(){return(v=(0,a.Z)((0,n.Z)().mark((function t(r,a,c,o){var u,p,f,d,l,h;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,i.i)(c)){t.next=4;break}o.value=a,t.next=21;break;case 4:return t.next=6,Promise.resolve().then(e.t.bind(e,49242,19));case 6:return u=t.sent.default,p=r.getSigner(),f=r.getProvider(),d=new s.cr(p||f,c,u,r.options,r.storage),t.next=12,r.getSignerAddress();case 12:return l=t.sent,h=r.address,t.next=16,d.read("allowance",[l,h]);case 16:if(!t.sent.lt(a)){t.next=20;break}return t.next=20,d.sendTransaction("approve",[h,a]);case 20:return t.abrupt("return",o);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}}]);